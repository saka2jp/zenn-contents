---
title: "Python3ã¸ã®ç§»è¡Œãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«ã™ã‚‹"
emoji: "ğŸ"
type: "tech"
topics: [Python, å‹‰å¼·ä¼š, Programming]
published: true
published_at: 2020-02-28 02:00
---

Python2 EOL party in Tokyo ã§ã€ŒPython3 ã¸ã®ç§»è¡Œãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«ã™ã‚‹ã€ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§ç™»å£‡ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

https://python2.connpass.com/event/161403/

é‹å–¶ã®ã¿ãªã•ã¾ã€ç™»å£‡æ©Ÿä¼šã‚’ã„ãŸã ãã¾ã—ã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

è³‡æ–™ã¯ SpeakerDeck ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://speakerdeck.com/saka2jp/how-to-reduce-risk-with-upgrading-to-python3

Twitter ã§ã®åå¿œã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚
ã¤ã¶ã‚„ã„ã¦ã„ãŸã ã„ãŸã¿ãªã•ã¾ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

https://togetter.com/li/1468904

ä»¥ä¸‹ã« Markdown å½¢å¼ã®è³‡æ–™ã‚‚å…¬é–‹ã—ã¾ã™ã€‚

# Python3 ã¸ã®ç§»è¡Œãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«ã™ã‚‹

## ä»Šå›ã®ãƒ†ãƒ¼ãƒ

ã€Œç§»è¡Œãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«ç•™ã‚ã‚‹ã€

ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ã‚Œã°ãƒªã‚¹ã‚¯ã¯æ¸›ã‚‰ã›ã‚‹

Python3 ã¸ã®ç§»è¡Œã®ãŸã‚ã«ç„¡é™ã«ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„
æ©Ÿèƒ½ã®ãƒªãƒªãƒ¼ã‚¹ã‚„ãƒã‚°ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒå„ªå…ˆã•ã‚Œã€ã‚€ã—ã‚ã»ã¨ã‚“ã©ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ã‚‰ã‚Œãªã„

å‰²ã‚ŠæŒ¯ã‚‰ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®ä¸­ã§ãƒªã‚¹ã‚¯ã‚’å¯èƒ½ãªé™ã‚Šæ¸›ã‚‰ã™ã®ãŒã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å½¹ç›®
ãã®ãŸã‚ã«ä½•ãŒã§ãã‚‹ã®ã‹

## Why We Need to Update?

1.  è„†å¼±æ€§
    - æ–°ãŸãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚°ãŒç™ºè¦šã—ãŸå ´åˆã«ã€æ”»æ’ƒã‚’å—ã‘ã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚‹
2.  æ–°æ©Ÿèƒ½
    - ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®åŠªåŠ›ã®æ©æµã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹
3.  è„±ãƒ¬ã‚¬ã‚·ãƒ¼
    - èª°ã—ã‚‚å¥½ã‚“ã§ãƒ¬ã‚¬ã‚·ãƒ¼ãªç’°å¢ƒã‚’é¸ã°ãªã„
    - æ–°ã—ã„äººã¯å…¥ã£ã¦ã“ãªã„ã—ã€æ—¢å­˜ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚‚é›¢è„±ã—ã¦ã—ã¾ã†ã‹ã‚‚

## How to Upgrade 2 to 3

### 1. è‡ªå‹•å¤‰æ›ãƒ„ãƒ¼ãƒ«

- [2to3](https://docs.python.org/3/library/2to3.html)
  - Python2 ã‚’ Python3 ã®ã‚³ãƒ¼ãƒ‰ã«å®Œå…¨ã«å¤‰æ›
- [Futurize](https://python-future.org/futurize.html) / [Modernize](https://python-modernize.readthedocs.io/en/latest/)
  - Python2/3 ã§å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ

**æ³¨æ„ç‚¹**

- ã™ã¹ã¦è‡ªå‹•åŒ–ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„
  - æ‰‹å‹•ã§ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãŒå¿…è¦ãªç®‡æ‰€ãŒã‚ã‚‹
- Python2.7 ã‚µãƒãƒ¼ãƒˆ
  - Python2.7 ã¾ã§ã¯è‡ªåŠ›ã§ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹

### 2. ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

Python3 ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¾ã§ã‚ã’ã‚‹
æœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®å·®åˆ†ã‚’ç¢ºèª -> æ›´æ–°

```bash
$ pip list -o
Package  Version  Latest  Type
--------  --------  ------- -----
requests  2.21.0    2.22.0  wheel
urllib3      1.24.3    1.25.8   wheel

$ pip install -U requests
```

**æ³¨æ„ç‚¹**

- å¾Œæ–¹äº’æ›æ€§ãŒãªã„å¤‰æ›´ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ãªãŒã‚‰
- ãã‚‚ãã‚‚ Python3 ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å¯èƒ½æ€§
  - ç‹¬è‡ªã§ç½®ãæ›ãˆã‚‹
  - ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¢ã™

### pyup.io

GUI ã§æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®å·®åˆ†ã‚’ç¢ºèªã§ãã‚‹
CHANGELOG ãŒã‚ã‚Œã°è¡¨ç¤ºã—ã¦ãã‚Œã‚‹

https://pyup.io/tools/requirements-checker/

## What We Should to Reduce Risk

ãƒªã‚¹ã‚¯ã‚’æ¸›ã‚‰ã™ãŸã‚ã«ä½•ãŒã§ãã‚‹ã‹

### 1. Python2 ã¨ Python3 ã®é•ã„ã‚’ç†è§£ã™ã‚‹

ã©ã‚“ãªãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã®ã‹ï¼ˆäº’æ›æ€§ãŒãªã„ç®‡æ‰€ï¼‰ã‚’ç†è§£ã™ã‚‹
ãƒªã‚¹ã‚¯ã®ã‚ã‚‹ç®‡æ‰€ã‚’é‡ç‚¹çš„ã«å¯¾ç­–ã™ã‚‹
Python å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚Œã°è­¦æˆ’ã™ã‚‹ã¹ãé•ã„ã¯ 2 ã¤ã ã‘

#### (1) æ–‡å­—åˆ—ã®æ‰±ã„

Python2 ã§ã® encode/decode ã¯ unicode å‹ã¨ str å‹
Python3 ã§ã® encode/decode ã¯ str å‹ã¨ byte å‹
Python3 ã® str å‹ã¯ Python2 ã® str å‹ã§ã¯ãªã unicode å‹ã¨åŒç­‰

```python
$ python2
>>> u'ã±ã„ãã‚“'.encode('utf-8')
'\xe3\x81\xb1\xe3\x81\x84\xe3\x81\x9d\xe3\x82\x93'
>>> '\xe3\x81\xb1\xe3\x81\x84\xe3\x81\x9d\xe3\x82\x93'.decode('utf-8')
u'\u3071\u3044\u305d\u3093'
```

```python
$ python3
>>> 'ã±ã„ãã‚“'.encode()
b'\xe3\x81\xb1\xe3\x81\x84\xe3\x81\x9d\xe3\x82\x93'
>>> b'\xe3\x81\xb1\xe3\x81\x84\xe3\x81\x9d\xe3\x82\x93'.decode()
'ã±ã„ãã‚“'
```

#### (2) é™¤ç®—

Python3 ã§ã¯ int åŒå£«ã®é™¤ç®—çµæœã¯ã™ã¹ã¦ float ã«ãªã‚‹

```bash
$ python2
>>> 1 / 2
0
```

```bash
$ python3
>>> 1 / 2
0.5
```

### 2. ãƒ†ã‚¹ãƒˆ

ç§»è¡Œå‰ã¨ç§»è¡Œå¾Œã®å‹•ä½œãŒåŒã˜ã§ã‚ã‚‹ã“ã¨ã‚’æ‹…ä¿ã™ã‚‹
ã–ã¾ã–ã¾ãªã‚¹ã‚³ãƒ¼ãƒ—ãŒã‚ã‚‹

- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼šé–¢æ•°ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ãƒ™ãƒ«ã§
- çµåˆãƒ†ã‚¹ãƒˆï¼š2 ä»¥ä¸Šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦
- E2E ãƒ†ã‚¹ãƒˆï¼šã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã‚’é€šã—ã¦

#### Testing Pyramid

ã©ã®ãƒ†ã‚¹ãƒˆã‚’ã©ã‚Œã ã‘å®Ÿæ–½ã™ã‚‹ã®ãŒã‚ˆã„ã®ã‹
Google ãŒèªã‚‹æœ€é©ãªãƒ†ã‚¹ãƒˆæˆ¦ç•¥
Python3 ã¸ã®ç§»è¡Œã§æœ€ã‚‚è²»ç”¨å¯¾åŠ¹æœãŒé«˜ã„ã®ã¯ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

https://testing.googleblog.com/2015/04/just-say-no-to-more-end-to-end-tests.html

#### Python ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

ã‚ˆã‚Šé«˜ã„ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒæœ›ã¾ã—ã„ãŒã‚³ã‚¹ãƒˆãŒé«˜ã„
å¾Œæ–¹äº’æ›æ€§ãŒãªã„ç®‡æ‰€ï¼ˆæ–‡å­—åˆ—ã‚„é™¤ç®—ï¼‰ã«ç‰¹ã«æ°—ã‚’ã¤ã‘ã¦ãƒ†ã‚¹ãƒˆã‚’ã‹ãã¨ã‚ˆã„

#### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹

å…ˆäººãŸã¡ã®å¿ƒå¼·ã„å‚è€ƒæ–‡çŒ®

- [åŠ¹æœçš„ãª unittest - ã¾ãŸã¯ã€callFUT ã®ç§˜å¯†](http://pelican.aodag.jp/xiao-guo-de-naunittest-mataha-callfutnomi-mi.html)
- [ã§ãã‚‹!Django ã§ãƒ†ã‚¹ãƒˆ!](https://tell-k.github.io/djangocongressjp2018)
- ãƒ†ã‚¹ãƒˆé§†å‹• Python

PyCon JP 2019 ã§ã¯ãƒ†ã‚¹ãƒˆã«é–¢ã™ã‚‹ãƒˆãƒ¼ã‚¯ãŒè±Šå¯Œã«ã‚ã£ãŸ
æœ€æ–°ã®æƒ…å ±ã¨ã—ã¦è£œå¡«ã™ã‚‹ã¨ã‚ˆã„

- [pytest ã«ã‚ˆã‚‹ CI ãƒ¬ãƒœãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³](https://speakerdeck.com/abenben/pytestniyorucireboriyusiyon)
- [unittest ã§å§‹ã‚ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå…¥é–€](https://docs.google.com/presentation/d/1F0fkcbuuQBCbVDLD2v8YQlMOqEMnF_PpI2AAR5nwhfI)
- [Python ã‚’ä½¿ã£ãŸ API ã‚µãƒ¼ãƒãƒ¼é–‹ç™ºã‚’å§‹ã‚ã‚‹éš›ã«æ•´å‚™ã—ãŸ CI ã¨ãƒ†ã‚¹ãƒˆæ©Ÿæ§‹](https://speakerdeck.com/hgsgtk/python-api-ci-test)

### 3. ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã‚„ã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨ˆæ¸¬ã‚’è‡ªå‹•åŒ–ã—ç¶™ç¶šçš„ã«å®Ÿè¡Œã™ã‚‹
ã‚«ãƒãƒ¬ãƒƒã‚¸ã¯å¸¸ã«å¯è¦–åŒ–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¯ãã®ã¨ãã®å®Ÿè£…è€…ãŒãã®ã¨ãã«æ›¸ãã®ãŒæœ€ã‚‚ã‚³ã‚¹ãƒˆãŒä½ã„
èª°ã‹ãŒãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦ãã‚Œã‚‹ä¿è¨¼ãªã‚“ã¦ãªã„
ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ±ºã—ã¦å¾Œå›ã—ã«ã—ãªã„

ãƒ†ã‚¹ãƒˆã‚’æ›¸ããƒ¡ãƒªãƒƒãƒˆã‚’å…±æœ‰ã—ã€ãƒ†ã‚¹ãƒˆã‚„ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ CI ã«çµ„ã¿è¾¼ã¿ä»•çµ„ã¿åŒ–ã™ã‚‹ã“ã¨ã§ã€å…ˆã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ–‡åŒ–ã‚’ä½œã‚‹ã€‚

### 4. ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é¸å®š

ç§»è¡Œã®ä¸­ã§ã‚‚ä¸€ã¤ã®éšœå£ã«ãªã‚Šã†ã‚‹
ä¾å­˜ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®æ•°ãŒå¤šã„ã»ã©ç§»è¡Œã®ãƒªã‚¹ã‚¯ãŒé«˜ãã‚³ã‚¹ãƒˆã‚‚é«˜ã„
ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚’å°å…¥ã™ã‚‹æ„æ€æ±ºå®šã¯æ…é‡ã«

- æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯è§£æ±ºã§ããªã„ã®ã‹
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã§ã—ã‹è§£æ±ºã§ããªã„ã®ã‹

ãã‚Œã§ã‚‚å°å…¥ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæŒ‡æ¨™ã‹ã‚‰ã©ã®ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãŒã‚ˆã„ã®ã‹ã€ä»Šå¾Œã‚‚ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œç¶šã‘ã‚‹è¦‹è¾¼ã¿ã¯ã‚ã‚‹ã®ã‹åˆ¤æ–­ã™ã‚‹

- ç›´è¿‘ã®ãƒªãƒªãƒ¼ã‚¹ã¯ã„ã¤ã‹
- ã©ã‚Œãã‚‰ã„ã®é »åº¦ã§ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹ã‹
- ã‚³ãƒŸãƒƒã‚¿ãƒ¼ã‚„ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®äººæ•°ã¯ä½•äººã‹
- ã©ã‚Œãã‚‰ã„åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã‹ï¼ˆ[PePy](https://pepy.tech/)ï¼‰
- ã‚¹ã‚¿ãƒ¼æ•°

### 5. ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è‡ªå‹•åŒ–

- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã® Pull ã‚’è‡ªå‹•ã§ä½œæˆã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹
- ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã¯ãƒ†ã‚¹ãƒˆã® CI ãŒæ§‹ç¯‰ã§ãã¦ã„ã‚Œã° CI ãŒãƒ‘ã‚¹ã—ãŸã‚‰åŸºæœ¬çš„ã«ã¯ãƒãƒ¼ã‚¸ã™ã‚Œã°ã‚ˆã„ã ã‘
- ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã—ã¦ã„ã¦ã‚‚æ°—ã‚’ã¤ã‘ã‚‹

  - ä¸€æ°—ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚ã’ã‚‹ã®ã¯ãƒªã‚¹ã‚¯ãŒé«˜ã„
  - å¿ƒç†çš„ãªè² æ‹…ã‚‚å¤§ãã„ã®ã§èª°ã‚‚ã‚„ã‚ŠãŸããªã„ -> ã•ã‚‰ã«æ”¾ç½®ã•ã‚Œã‚‹ ã¨ã„ã†æ‚ªå¾ªç’°ã«ãªã‚Šã‹ã­ãªã„
  - æ—¥ã€…ã‚³ãƒ„ã‚³ãƒ„ã¨ä¸Šã’ã¤ã¥ã‘ã‚‹ã“ã¨ãŒé‡è¦

- Dependabot
  - 2019 å¹´ã« GitHub ã«è²·åã•ã‚ŒãŸ Automated dependency updates ã‚µãƒ¼ãƒ“ã‚¹
  - Pipenv, Poetry, requirements.txt ã‚’ã‚µãƒãƒ¼ãƒˆ

https://dependabot.com/

- Renovate
  - ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ã«ä¾å­˜ã—ãªã„
  - GitLab, Bitbacket ã‚‚ã‚µãƒãƒ¼ãƒˆ

https://renovate.whitesourcesoftware.com/

## Python3 ã§ã®æ•™è¨“

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚’ã‚¹ãƒãƒƒãƒˆã®ä½œæ¥­ã¨æ‰ãˆãªã„
ç¶™ç¶šçš„ã«å–ã‚Šçµ„ã¿ã‚’è¡Œã†ã“ã¨ã§ç§»è¡Œã®ãƒªã‚¹ã‚¯ã‚‚ã‚³ã‚¹ãƒˆã‚‚ä¸‹ã’ã‚‹

## å‚è€ƒæ–‡çŒ®

- [Porting Python 2 Code to Python 3](https://docs.python.org/3/howto/pyporting.html)
- [Automatic conversion to Py2/3](http://python-future.org/automatic_conversion.html)
