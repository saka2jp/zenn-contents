---
title: "ã€jQueryã€‘äºŒé‡é€ä¿¡ã‚’é˜²æ­¢ã—ã¤ã¤ã€é€£ç¶šé€ä¿¡ã‚’ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ"
type: "tech"
topics: [JavaScript, Rails, jQuery]
published: true
published_at: 2017-02-13 09:07
---

# ã¯ã˜ã‚ã«

ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ä¸­ã«ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ï¼’é‡é€ä¿¡ã‚’é˜²ããŸã„ã‘ã©ï¼’é‡é€ä¿¡ã‚’é˜²æ­¢ã—ãŸã‚‰é€£ç¶šé€ä¿¡ã§ããªã„ã˜ã‚ƒã‚“ï¼ã¨ã„ã†ç¾è±¡ã«ãƒãƒã£ãŸã®ã§ãã®è§£æ±ºæ–¹æ³•ã‚’è¨˜ã—ã¾ã™ã€‚

# äºŒé‡é€ä¿¡ã‚’é˜²æ­¢

`= f.submit "Send", "data-disable-with": "é€ä¿¡ä¸­..."`
ã¾ãŸã¯
`= f.submit "Send", data: {disable_with: 'é€ä¿¡...'}`
ã¨ã™ã‚‹ã“ã¨ã§ã€é€ä¿¡ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ãªãã—ã¦ã€"é€ä¿¡ä¸­..."ãªã©ã‚‚æ–‡è¨€ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚
ã—ã‹ã—ã€ã“ã‚Œã‚’å®Ÿè£…ã—ã¦ã—ã¾ã†ã¨é€£ç¶šæŠ•ç¨¿ãŒã§ãã¾ã›ã‚“ã€‚

<é€£ç¶šé€ä¿¡ä¸å¯>
![fda2ca3c63d60385c1b754be5bd68be1.gif](/images/qiita/f780f8b7-0489-21fe-8428-179820e29a35.gif)

# è§£æ±ºç­– â‘ 

data-disable-with å±æ€§ã‚’è§£é™¤ã™ã‚‹ã€‚
`$('ã‚»ãƒ¬ã‚¯ã‚¿').removeAttr('data-disable-with')`

# è§£æ±ºç­– â‘¡

submit ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§è¿”ã‚Šå€¤ã‚’ false ã«ã™ã‚‹ã€‚
ã“ã†ã™ã‚‹ã“ã¨ã§ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚’ä¸€æ—¦æ­¢ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js
$('ã‚»ãƒ¬ã‚¯ã‚¿').submit(function() {
ã€€ã€€â€¦
 return false;
});
```

<é€£ç¶šé€ä¿¡å¯èƒ½>
![63e556849385a64a7b827c54969d59c4.gif](/images/qiita/131a77a2-60e0-f0ec-f13f-c5eea85bcb64.gif)

è§£æ±ºç­– â‘ â‘¡ å…±ã«é€£ç¶šæŠ•ç¨¿ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

# å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰

## è§£æ±ºç­– â‘ 

```js:message.js
$(function() {
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æƒ…å ±ã‚’è¿½åŠ ã—ã¦ã„ãé–¢æ•°
  function buildHTML(message) {
    var html =
    '<li class="chat-message">' +
      '<p class="chat-message__name">' +
          message.name +
      '</p>' +
      '<p class="chat-message__time">' +
          message.time +
      '</p>' +
      '<p class="chat-message__body">' +
          message.body +
      '</p>' +
      '<br>' +
      '<img class="chat-message__image" src="' + message.image + '">'
    '</li>'
    return html;
  }

  $('#new_message').on('submit', function(e) {
    // HTMLã§ã®é€ä¿¡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    e.preventDefault();
    var form = $('#new_message');
    var $this = $(this);

    //è¿½è¨˜éƒ¨åˆ†
    $('#chat-footer__send-btn').removeAttr('data-disable-with');

    // ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã•ã‚ŒãŸå€¤ã‚’å–å¾—
    var fd = new FormData($this.get(0));

    $.ajax({
      type: form.attr('method'), // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ("post")ã‚’å–å¾—
      url: form.attr('action'), // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ("/chat_group/chat_group_id/messages")ã‚’å–å¾—
      data: fd,
      contentType : false,
      processData : false,
      dataType: 'json'
    })
    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å€¤ãŒæ­£ã—ãè¿”ã£ã¦ããŸå ´åˆ
    .done(function(data) {
      var html = buildHTML(data.message);
      $('.chat-messages').append(html);
      $this.get(0).reset();
      autoScroll();
    })
    // æ­£ã—ãè¿”ã£ã¦ã“ãªã‹ã£ãŸå ´åˆ
    .fail(function() {
      alert('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã§ãã¾ã›ã‚“');
    });
  });
});
```

## è§£æ±ºç­– â‘¡

```js:message.js
$(function() {
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æƒ…å ±ã‚’è¿½åŠ ã—ã¦ã„ãé–¢æ•°
  function buildHTML(message) {
    var html =
    '<li class="chat-message">' +
      '<p class="chat-message__name">' +
          message.name +
      '</p>' +
      '<p class="chat-message__time">' +
          message.time +
      '</p>' +
      '<p class="chat-message__body">' +
          message.body +
      '</p>' +
      '<br>' +
      '<img class="chat-message__image" src="' + message.image + '">'
    '</li>'
    return html;
  }
  $('#new_message').submit(function(e) {//ä¿®æ­£éƒ¨åˆ†
    // HTMLã§ã®é€ä¿¡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    e.preventDefault();
    var form = $('#new_message');
    var $this = $(this);
    // ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã•ã‚ŒãŸå€¤ã‚’å–å¾—
    var fd = new FormData($this.get(0));

    $.ajax({
      type: form.attr('method'), // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ("post")ã‚’å–å¾—
      url: form.attr('action'), // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ("/chat_group/chat_group_id/messages")ã‚’å–å¾—
      data: fd,
      contentType : false,
      processData : false,
      dataType: 'json'
    })
    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å€¤ãŒæ­£ã—ãè¿”ã£ã¦ããŸå ´åˆ
    .done(function(data) {
      var html = buildHTML(data.message);
      $('.chat-messages').append(html);
      $this.get(0).reset();
      autoScroll();
    })
    // æ­£ã—ãè¿”ã£ã¦ã“ãªã‹ã£ãŸå ´åˆ
    .fail(function() {
      alert('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã§ãã¾ã›ã‚“');
    });
    //è¿½è¨˜éƒ¨åˆ†
    return false;
  });
});
```

## HTML

```ruby:message.html.haml
.chat-body
  %ul.chat-messages
  - @chat_group.messages.each do |message|
    %li.chat-message
      %p.chat-message__name
        = message.user.name
      %p.chat-message__time
        = message.created_at
      %p.chat-message__body
        = message.body
        - if message.image?
          %br
          = image_tag message.image.url
.chat-footer
  = form_for [@chat_group, @message] do |f|
    .chat-footer__body
      = f.text_area :body, placeholder: "type a message"
      .chat-footer__body__image
        = f.label :image do
          %i.fa.fa-image
            = f.file_field :image
    .chat-footer__btn
      = f.submit "Send", "data-disable-with": "é€ä¿¡ä¸­...", id: 'chat-footer__send-btn', class: 'chat-footer__send-btn'
```

# ãŠã‚ã‚Šã«

rails2 ãƒ¶æœˆç›®ã€jquery1 ãƒ¶æœˆç›®ã®è¶…åˆå¿ƒè€…ã§ã™ã€‚
æ”¹å–„ç‚¹ã€å•é¡Œç‚¹ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã”æŒ‡æ‘˜ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

# å‚è€ƒè¨˜äº‹

[jQuery ã§ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚’ä¸€æ—¦æ­¢ã‚ã€å‡¦ç†ã‚’æŒŸã‚“ã§ã‹ã‚‰é€ä¿¡ã™ã‚‹æ–¹æ³•](https://2inc.org/blog/2013/04/05/3117/)
[[Rails]submit ã‚¿ã‚°ã«ã¤ã‘ã¦ãŠããŸã„ disable_with ã‚ªãƒ—ã‚·ãƒ§ãƒ³](http://qiita.com/sue738/items/09f569bdc3a73d26df88)
